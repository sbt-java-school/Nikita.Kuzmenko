# Задание №18

## Задача №1

Написать клиент-серверное приложение "Гадалка"

Сервер: отвечает за подключение новых клиентов (максимум MAX_COUNT_OF_THREADS)

Каждый новый клиент обрабатывается в отдельном потоке

Поведение клиента и сервера подчиняется протоколу:

1. Сервер ожидает подключения нового клиента
2. Клиент подключается и отправляет свое имя,
3. Клиент отправляет число, введенное пользователем,
3. Сервер отвечает либо ДА либо НЕТ в качестве переменной типа String
4. Операция повторяется, пока клиент не угадает число


## Задача №2

Разработать клиент-серверное приложение SchoolChat

• Вход в систему по логину – дополнительных проверок не надо делать
• Историю чатов хранить не нужно
• Сервер понимает 2 команды:
    • Отправить сообщение пользователю
    • Получить все сообщения адресованные текущему пользователю
• Клиент при получении сообщения просто выводит информацию:
    • «user >> message_text»


### Реализация

Взаимодействие между клиентом и сервером осуществляется при при помощи сокетов.
Сервер создает экземпляр класса **DataStorageImpl** и ожидает подключения новых клиентов по определённому адресу и порту по TCP протоколу,
перенаправляет дальнейшее общение в отдельный поток "сервер-процессу".

При подключении нового клиента, сервер запускает отдельный поток серверного приложения для взаимодействия с ним.
Количество клиентов ограничено количеством доступных тред в пуле, так как большое количество
постоянно поддерживаемых TCP соединений и самих подпроцессов достаточно накладно.

Каждый новый "сервер-процесс" получает на вход сокет для взаимодействия и экземпляр класса **DataStorageImpl** для хранения информации о клиенте.

Как только новый пользователь подключился, "сервер-процесс" инициирует процесс авторизации клиента по логину, отправленному клиентом.
Для этого сервер отправляет клиенту запрос на введение логина, клиент отправляте ответ, введенный пользователем.


Когда сервер получает какую-либо команду, будь то запрос на список сообщений,
или запрос на разрыв соединения, или написание сообщения пользователю чата, на
самом деле происходит следующая последовательность действий:

1."сервер-процесс" проверяет запрос ли это или просто сообщение.
2.Если запрос (команда), то выводим результат клиенту, если сообщение отправляем на корректность созданному экземпляру класса **ParseText**.
3.Экземпляр класса **ParseText** парсит присланное сообщение, выделяя получателя и само сообщение.
3. Сервер ожидает команду от клиента и после получения возвращает соответствующий ответ:
 - Если это запрос на список сообщений клиента - возвращает сериализованный список объектов типпа Message
 - Если это запрос на разрыв соединения - завершает бесконечный цикл ожидания команд от клиента,
 закрывает сокет и потоки ввода-вывода и завершает работу трэды.
 - Если это новое сообщения и оно корректно - используя мультимапу, кладем сообщение в сериализованный список объектов типпа Message с ключем (получатель).
 - Иначе игнорируем сообщение.





